# 故障排除指南

## 常见问题和解决方案

### 部署相关

#### 问题1：部署失败，显示"Build failed"

**可能原因：**
- 缺少某个文件
- `requirements.txt` 有问题
- Python版本不兼容

**解决方案：**
1. 检查Render的日志，找到具体错误信息
2. 确保这些文件都在仓库中：
   - `app.py`
   - `requirements.txt`
   - `templates/index.html`
   - `Procfile`
   - `runtime.txt`
3. 如果是Python版本问题，在Render中改为 `Python 3.11`

#### 问题2：部署成功但应用无法打开

**可能原因：**
- 应用还在启动中
- 服务器出错

**解决方案：**
1. 等待2-3分钟
2. 刷新浏览器
3. 检查Render的"Logs"标签，看是否有错误
4. 点击"Redeploy"重新部署

#### 问题3：显示"Service Unavailable"

**可能原因：**
- 应用崩溃了
- 服务器过载

**解决方案：**
1. 等待几分钟
2. 点击Render中的"Redeploy"
3. 检查日志找出具体错误

---

### 搜索相关

#### 问题4：搜索返回"No listings found"

**可能原因：**
- 网站改变了HTML结构
- 搜索词不准确
- 网站暂时无法访问

**解决方案：**
1. 尝试不同的车型名称：
   - "Honda Civic" 而不是 "civic"
   - "Toyota Camry" 而不是 "camry"
2. 尝试不同的地区
3. 直接访问Kijiji或AutoTrader，看是否能找到该车型
4. 等几天后重试（网站可能在更新）

#### 问题5：搜索很慢（超过2分钟）

**这是正常的！** 爬虫需要从网站抓取数据。

**但如果超过3分钟：**
1. 检查网络连接
2. 尝试刷新页面重新搜索
3. 尝试搜索更少的平台（只选Kijiji或只选AutoTrader）

#### 问题6：某个平台的搜索不工作

**可能原因：**
- 网站改变了结构
- 网站有反爬虫保护
- 网站暂时无法访问

**解决方案：**
1. 直接访问该网站，看是否正常
2. 尝试只搜索其他平台
3. 等几天后重试
4. 如果问题持续，可能需要更新爬虫代码

---

### AI总结相关

#### 问题7：AI总结功能不工作

**可能原因：**
- 没有设置OpenAI API密钥
- API密钥无效
- API额度用完了

**解决方案：**
1. 确认你设置了 `OPENAI_API_KEY` 环境变量
2. 检查API密钥是否正确：
   - 访问 https://platform.openai.com/api-keys
   - 复制完整的密钥（不要截断）
3. 检查API使用情况：
   - 访问 https://platform.openai.com/account/usage
   - 看是否有余额或额度
4. 如果没有额度，添加付款方式

#### 问题8：AI总结很慢

**这是正常的！** OpenAI API需要时间处理。

**优化方法：**
1. 不勾选"Summarize descriptions"，只看原始描述
2. 减少搜索结果数量（搜索更具体的车型）
3. 等待API响应（通常需要30秒）

#### 问题9：AI总结的内容不准确

**这是AI的限制。** 有时AI可能理解错误或遗漏信息。

**解决方案：**
1. 总是查看原始描述
2. 点击"View on [Platform]"查看完整信息
3. 联系卖家确认细节

---

### 本地运行相关

#### 问题10：运行 `run_local.sh` 失败

**可能原因：**
- Python没有安装
- 权限问题

**解决方案：**

**Mac/Linux：**
```bash
# 确保Python已安装
python3 --version

# 给脚本执行权限
chmod +x run_local.sh

# 运行脚本
./run_local.sh
```

**Windows：**
1. 确保Python已安装
2. 双击 `run_local.bat`
3. 如果不工作，打开命令提示符，运行：
   ```bash
   python -m venv venv
   venv\Scripts\activate
   pip install -r requirements.txt
   python app.py
   ```

#### 问题11：本地运行时显示"Port 5000 is already in use"

**解决方案：**

**Mac/Linux：**
```bash
# 找到占用端口的进程
lsof -i :5000

# 杀死进程（替换PID）
kill -9 <PID>

# 或者用不同的端口
python app.py --port 5001
```

**Windows：**
```bash
# 找到占用端口的进程
netstat -ano | findstr :5000

# 杀死进程（替换PID）
taskkill /PID <PID> /F

# 或者用不同的端口
python app.py --port 5001
```

#### 问题12：本地运行时出现"ModuleNotFoundError"

**解决方案：**
```bash
# 确保虚拟环境已激活
source venv/bin/activate  # Mac/Linux
# 或
venv\Scripts\activate  # Windows

# 重新安装依赖
pip install -r requirements.txt

# 运行应用
python app.py
```

---

### 代码相关

#### 问题13：我想修改爬虫逻辑

**步骤：**
1. 编辑 `app.py` 中的 `scrape_kijiji()` 或 `scrape_autotrader()` 函数
2. 上传到GitHub
3. Render会自动重新部署

**提示：**
- 使用浏览器的"检查元素"功能找到正确的HTML选择器
- 在本地测试修改，确保工作正常
- 使用 `logger.info()` 添加调试信息

#### 问题14：我想修改前端界面

**步骤：**
1. 编辑 `templates/index.html`
2. 上传到GitHub
3. Render会自动重新部署

**提示：**
- 修改CSS来改变样式
- 修改HTML来改变布局
- 修改JavaScript来改变功能

---

### 网络相关

#### 问题15：应用在某些地区无法访问

**可能原因：**
- 网络限制
- DNS问题
- ISP限制

**解决方案：**
1. 尝试用不同的网络（4G/WiFi）
2. 尝试用VPN
3. 尝试用不同的浏览器
4. 等几小时后重试

---

## 获取帮助

### 检查日志

**在Render上：**
1. 打开应用页面
2. 点击"Logs"标签
3. 查看最新的日志信息

**在本地：**
1. 查看终端输出
2. 查看 `/tmp/app.log` 文件

### 常用命令

```bash
# 检查Python版本
python3 --version

# 检查依赖是否安装
pip list

# 重新安装依赖
pip install -r requirements.txt --upgrade

# 运行应用（调试模式）
python app.py --debug

# 测试API
curl http://localhost:5000/api/health
```

### 联系支持

如果问题仍未解决：
1. 检查GitHub Issues
2. 查看应用日志
3. 尝试重新部署
4. 联系开发者

---

## 性能优化

### 如果应用很慢

1. **减少搜索范围**：只搜索一个地区而不是全加拿大
2. **禁用AI总结**：不勾选"Summarize descriptions"
3. **减少结果数量**：搜索更具体的车型

### 如果部署很慢

1. 这是正常的，第一次部署可能需要5-10分钟
2. 后续部署会更快
3. 可以在Render的日志中看到进度

---

## 更新应用

### 获取最新版本

1. 在GitHub上下载最新代码
2. 上传到你的仓库
3. Render会自动重新部署

### 更新依赖

```bash
# 本地更新
pip install -r requirements.txt --upgrade

# 提交更改
git add requirements.txt
git commit -m "Update dependencies"
git push
```

---

## 报告问题

如果发现Bug，请：
1. 记录具体的错误信息
2. 记录重现步骤
3. 检查日志
4. 在GitHub上提Issue

---

祝你使用愉快！有问题随时问。

